"use strict";(globalThis["webpackChunkfirefly_iii"]=globalThis["webpackChunkfirefly_iii"]||[]).push([[7889],{7889:(t,e,n)=>{n.r(e),n.d(e,{default:()=>M});var i=n(9835),a=n(6970);const s=["title"],r=(0,i.Uk)(": "),o=["title"],u={key:0},d=(0,i._)("br",null,null,-1),l=["title"],p=["title"],m={key:0};function c(t,e,n,c,h,g){const f=(0,i.up)("q-item-label"),v=(0,i.up)("q-item-section"),_=(0,i.up)("q-item"),w=(0,i.up)("q-separator"),y=(0,i.up)("q-circular-progress"),A=(0,i.up)("q-card-section"),k=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(k,{bordered:"",flat:"",class:"fit"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i._)("strong",null,(0,a.zw)(t.$t("firefly.bills")),1)])),_:1})])),_:1})])),_:1}),(0,i.Wm)(w),(0,i.Wm)(A,{horizontal:""},{default:(0,i.w5)((()=>[(0,i.Wm)(A,null,{default:(0,i.w5)((()=>[(0,i.Wm)(y,{thickness:.22,value:g.percentage,color:"positive",size:"50px","track-color":"negative"},null,8,["thickness","value"])])),_:1}),(0,i.Wm)(w,{vertical:""}),0===h.unpaid.length&&0===h.paid.length?((0,i.wg)(),(0,i.j4)(A,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.$t("firefly.no_bill")),1)])),_:1})):(0,i.kq)("",!0),h.unpaid.length>0||h.paid.length>0?((0,i.wg)(),(0,i.j4)(A,{key:1},{default:(0,i.w5)((()=>[(0,i._)("span",{title:g.formatAmount(this.currency,this.unpaidAmount)},(0,a.zw)(t.$t("firefly.bills_to_pay")),9,s),r,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.unpaid,((t,e)=>((0,i.wg)(),(0,i.iD)("span",null,[(0,i._)("span",{title:g.formatAmount(t.native_code,t.native_sum)},[(0,i.Uk)((0,a.zw)(g.formatAmount(t.code,t.sum)),1),e+1!==h.unpaid.length?((0,i.wg)(),(0,i.iD)("span",u," + ")):(0,i.kq)("",!0)],8,o)])))),256)),d,h.paid.length>0?((0,i.wg)(),(0,i.iD)("span",{key:0,title:g.formatAmount(this.currency,this.paidAmount)},(0,a.zw)(t.$t("firefly.bills_paid"))+":",9,l)):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.paid,((t,e)=>((0,i.wg)(),(0,i.iD)("span",null,[(0,i._)("span",{title:g.formatAmount(t.native_code,t.native_sum)},(0,a.zw)(g.formatAmount(t.code,t.sum)),9,p),e+1!==h.paid.length?((0,i.wg)(),(0,i.iD)("span",m," + ")):(0,i.kq)("",!0)])))),256))])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1})}var h=n(3555),g=n(1569),f=n(8898);class v{unpaid(t,e){let n="api/v2/bills/sum/unpaid",i=(0,f.Z)(t,"y-MM-dd"),a=(0,f.Z)(e,"y-MM-dd");return g.api.get(n,{params:{start:i,end:a}})}paid(t,e){let n="api/v2/bills/sum/paid",i=(0,f.Z)(t,"y-MM-dd"),a=(0,f.Z)(e,"y-MM-dd");return g.api.get(n,{params:{start:i,end:a}})}}const _={data(){return{store:null,unpaid:[],paid:[],currency:"EUR",unpaidAmount:0,paidAmount:0}},name:"BillInsightBox",computed:{percentage:function(){if(0===this.unpaidAmount)return 100;if(0===this.paidAmount)return 0;const t=this.paidAmount+this.unpaidAmount,e=this.paidAmount/t*100;return e>100?100:e}},mounted(){this.store=(0,h.S)(),this.store.$onAction((({name:t,$store:e,args:n,after:i,onError:a})=>{i((e=>{"setRange"===t&&this.triggerUpdate()}))})),this.triggerUpdate()},methods:{triggerUpdate:function(){if(null!==this.store.getRange.start&&null!==this.store.getRange.end){this.unpaid=[];const t=new Date(this.store.getRange.start),e=new Date(this.store.getRange.end),n=new v;this.currency=this.store.getCurrencyCode,n.unpaid(t,e).then((t=>this.parseUnpaidResponse(t.data))),n.paid(t,e).then((t=>this.parsePaidResponse(t.data)))}},formatAmount:function(t,e){return Intl.NumberFormat(this.store.getLocale,{style:"currency",currency:t}).format(e)},parseUnpaidResponse:function(t){for(let e in t)if(t.hasOwnProperty(e)){const n=t[e],i=n.converted&&n.native_id!==n.id&&0!==parseFloat(n.native_sum);this.unpaid.push({sum:n.sum,code:n.code,native_sum:n.converted?n.native_sum:n.sum,native_code:n.converted?n.native_code:n.code,native:i}),n.converted&&(i||n.native_id===n.id)&&(this.unpaidAmount=this.unpaidAmount+parseFloat(n.native_sum)),n.converted||(this.unpaidAmount=this.unpaidAmount+parseFloat(n.sum))}},parsePaidResponse:function(t){for(let e in t)if(t.hasOwnProperty(e)){const n=t[e],i=n.converted&&n.native_id!==n.id&&0!==parseFloat(n.native_sum);this.paid.push({sum:n.sum,code:n.code,native_sum:n.converted?n.native_sum:n.sum,native_code:n.converted?n.native_code:n.code,native:i}),n.converted&&(i||n.native_id===n.id)&&(this.paidAmount=this.paidAmount+-1*parseFloat(n.native_sum)),n.converted||(this.paidAmount=this.paidAmount+-1*parseFloat(n.sum))}}}};var w=n(1639),y=n(4458),A=n(490),k=n(1233),b=n(3115),q=n(926),Z=n(3190),R=n(3302),D=n(9984),U=n.n(D);const z=(0,w.Z)(_,[["render",c]]),M=z;U()(_,"components",{QCard:y.Z,QItem:A.Z,QItemSection:k.Z,QItemLabel:b.Z,QSeparator:q.Z,QCardSection:Z.Z,QCircularProgress:R.Z})}}]);