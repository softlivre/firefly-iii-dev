"use strict";(globalThis["webpackChunkfirefly_iii"]=globalThis["webpackChunkfirefly_iii"]||[]).push([[9376],{9376:(s,e,t)=>{t.r(e),t.d(e,{default:()=>Y});var r=t(9835),a=t(6970);const o={class:"row q-mx-md"},i={class:"col-12"},n={class:"row"},l={class:"col-12"},d={class:"text-h6"},u={class:"row"},c={class:"col-12 q-mb-xs"},m={class:"row"},b={class:"col-4 q-mb-xs q-pr-xs"},p={class:"col-4 q-px-xs"},h={class:"col-4 q-pl-xs"},f={class:"row"},_={class:"col-4"},g={class:"row"},w={class:"col"},E={class:"col"},v={class:"row q-mx-md"},V={class:"col-12"},y={class:"row"},S={class:"col-12 text-right"},k={class:"row"},x={class:"col-12 text-right"};function q(s,e,t,q,I,T){const U=(0,r.up)("q-btn"),W=(0,r.up)("q-banner"),Z=(0,r.up)("q-card-section"),C=(0,r.up)("q-input"),$=(0,r.up)("q-card"),Q=(0,r.up)("q-tab-panel"),M=(0,r.up)("q-tab-panels"),D=(0,r.up)("q-checkbox"),R=(0,r.up)("q-page");return(0,r.wg)(),(0,r.j4)(R,null,{default:(0,r.w5)((()=>[(0,r._)("div",o,[(0,r._)("div",i,[""!==I.errorMessage?((0,r.wg)(),(0,r.j4)(W,{key:0,class:"bg-orange text-white","inline-actions":"",rounded:""},{action:(0,r.w5)((()=>[(0,r.Wm)(U,{flat:"",label:"Dismiss",onClick:T.dismissBanner},null,8,["onClick"])])),default:(0,r.w5)((()=>[(0,r.Uk)((0,a.zw)(I.errorMessage)+" ",1)])),_:1})):(0,r.kq)("",!0)])]),(0,r._)("div",n,[(0,r._)("div",l,[(0,r.Wm)(M,{modelValue:I.tab,"onUpdate:modelValue":e[0]||(e[0]=s=>I.tab=s),animated:""},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(I.transactions,((e,t)=>((0,r.wg)(),(0,r.j4)(Q,{key:t,name:"split-"+t},{default:(0,r.w5)((()=>[(0,r.Wm)($,{bordered:""},{default:(0,r.w5)((()=>[(0,r.Wm)(Z,null,{default:(0,r.w5)((()=>[(0,r._)("div",d,"Info for "+(0,a.zw)(s.$route.params.type)+" "+(0,a.zw)(t),1)])),_:2},1024),(0,r.Wm)(Z,null,{default:(0,r.w5)((()=>[(0,r._)("div",u,[(0,r._)("div",c,[(0,r.Wm)(C,{modelValue:e.description,"onUpdate:modelValue":s=>e.description=s,disable:T.disabledInput,error:I.hasSubmissionErrors[t].description,"error-message":I.submissionErrors[t].description,label:s.$t("firefly.description"),"bottom-slots":"",clearable:"",outlined:"",type:"text"},null,8,["modelValue","onUpdate:modelValue","disable","error","error-message","label"])])]),(0,r._)("div",m,[(0,r._)("div",b,[(0,r.Wm)(C,{modelValue:e.source,"onUpdate:modelValue":s=>e.source=s,disable:T.disabledInput,error:I.hasSubmissionErrors[t].source,"error-message":I.submissionErrors[t].source,label:s.$t("firefly.source_account"),"bottom-slots":"",clearable:"",outlined:""},null,8,["modelValue","onUpdate:modelValue","disable","error","error-message","label"])]),(0,r._)("div",p,[(0,r.Wm)(C,{modelValue:e.amount,"onUpdate:modelValue":s=>e.amount=s,disable:T.disabledInput,error:I.hasSubmissionErrors[t].amount,"error-message":I.submissionErrors[t].amount,label:s.$t("firefly.amount"),"bottom-slots":"",clearable:"","fill-mask":"0",hint:"Expects #.##",mask:"#.##",outlined:"","reverse-fill-mask":""},null,8,["modelValue","onUpdate:modelValue","disable","error","error-message","label"])]),(0,r._)("div",h,[(0,r.Wm)(C,{modelValue:e.destination,"onUpdate:modelValue":s=>e.destination=s,disable:T.disabledInput,error:I.hasSubmissionErrors[t].destination,"error-message":I.submissionErrors[t].destination,label:s.$t("firefly.destination_account"),"bottom-slots":"",clearable:"",outlined:""},null,8,["modelValue","onUpdate:modelValue","disable","error","error-message","label"])])]),(0,r._)("div",f,[(0,r._)("div",_,[(0,r._)("div",g,[(0,r._)("div",w,[(0,r.Wm)(C,{modelValue:e.date,"onUpdate:modelValue":s=>e.date=s,disable:T.disabledInput,error:I.hasSubmissionErrors[t].date,"error-message":I.submissionErrors[t].date,hint:s.$t("firefly.date"),"bottom-slots":"",outlined:"",type:"date"},null,8,["modelValue","onUpdate:modelValue","disable","error","error-message","hint"])]),(0,r._)("div",E,[(0,r.Wm)(C,{modelValue:e.time,"onUpdate:modelValue":s=>e.time=s,disable:T.disabledInput,hint:s.$t("firefly.time"),"bottom-slots":"",outlined:"",type:"time"},null,8,["modelValue","onUpdate:modelValue","disable","hint"])])])])])])),_:2},1024)])),_:2},1024)])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])])]),(0,r._)("div",v,[(0,r._)("div",V,[(0,r.Wm)($,{class:"q-mt-xs"},{default:(0,r.w5)((()=>[(0,r.Wm)(Z,null,{default:(0,r.w5)((()=>[(0,r._)("div",y,[(0,r._)("div",S,[(0,r.Wm)(U,{disable:T.disabledInput,color:"primary",label:"Submit",onClick:T.submitTransaction},null,8,["disable","onClick"])])]),(0,r._)("div",k,[(0,r._)("div",x,[(0,r.Wm)(D,{modelValue:I.doReturnHere,"onUpdate:modelValue":e[1]||(e[1]=s=>I.doReturnHere=s),disable:T.disabledInput,label:"Return here","left-label":""},null,8,["modelValue","disable"])])])])),_:1})])),_:1})])])])),_:1})}var I=t(8898),T=t(5115),U=t(1569);class W{put(s,e){let t="/api/v1/transactions/"+s;return U.api.put(t,e)}}var Z=t(9466),C=t(3555);const $={name:"Edit",data(){return{tab:"split-0",transactions:[],submissionErrors:[],hasSubmissionErrors:[],submitting:!1,doReturnHere:!1,index:0,doResetForm:!1,group_title:"",errorMessage:"",store:null}},computed:{disabledInput:function(){return this.submitting}},created(){this.id=parseInt(this.$route.params.id),this.store=(0,C.S)(),this.resetForm(),this.collectTransaction()},methods:{collectTransaction:function(){let s=new Z.Z;s.get(this.id).then((s=>this.parseTransaction(s)))},parseTransaction:function(s){this.group_title=s.data.data.attributes.group_title;let e=s.data.data.attributes.transactions;e.reverse();for(let t in e)if(e.hasOwnProperty(t)){let s=e[t],r=parseInt(t);if(0===r){let e=s.date.split("T"),t=e[0],r=e[1].substr(0,8);this.transactions.push({description:s.description,type:s.type,date:t,time:r,amount:parseFloat(s.amount).toFixed(s.currency_decimal_places),source:s.source_name,destination:s.destination_name})}}},resetForm:function(){this.transactions=[];const s=this.getDefaultTransaction();this.transactions=[],this.submissionErrors.push(s.submissionError),this.hasSubmissionErrors.push(s.hasSubmissionError)},dismissBanner:function(){this.errorMessage=""},submitTransaction:function(){this.submitting=!0,this.errorMessage="",this.resetErrors();const s=this.buildTransaction();let e=new W;e.put(this.id,s).catch(this.processErrors).then(this.processSuccess)},processSuccess:function(s){this.submitting=!1,this.store.refreshCacheKey();let e={level:"success",text:"Updated transaction",show:!0,action:{show:!0,text:"Go to transaction",link:{name:"transactions.show",params:{id:parseInt(s.data.data.id)}}}};this.$q.localStorage.set("flash",e),this.doReturnHere&&window.dispatchEvent(new CustomEvent("flash",{detail:{flash:this.$q.localStorage.getItem("flash")}})),this.doReturnHere||this.$router.go(-1)},resetErrors:function(){let s=this.transactions.length,e=this.getDefaultTransaction();for(let t=0;t<s;t++)this.submissionErrors[t]=e.submissionError,this.hasSubmissionErrors[t]=e.hasSubmissionError},processErrors:function(s){if(s.response){let e=s.response.data;this.errorMessage=e.message;for(let s in e.errors)e.errors.hasOwnProperty(s)&&this.processSingleError(s,e.errors[s])}this.submitting=!1},processSingleError:function(s,e){let t=parseInt(s.split(".")[1]),r=s.split(".")[2];switch(r){case"amount":case"date":case"description":this.submissionErrors[t][r]=e[0],this.hasSubmissionErrors[t][r]=!0;break;case"source_id":case"source_name":this.submissionErrors[t].source=e[0],this.hasSubmissionErrors[t].source=!0;break;case"destination_id":case"destination_name":this.submissionErrors[t].source=e[0],this.hasSubmissionErrors[t].source=!0;break}},buildTransaction:function(){const s={transactions:[]};return this.transactions.forEach((e=>{let t=(0,T.Z)(new Date(e.date+" "+e.time)),r={type:e.type,description:e.description,source_name:e.source,destination_name:e.destination,amount:e.amount,date:t};s.transactions.push(r)})),s},getDefaultTransaction:function(){let s="",e="00:00";return 0===this.transactions.length&&(s=(0,I.Z)(new Date,"yyyy-MM-dd")),{submissionError:{description:"",amount:"",date:"",source:"",destination:""},hasSubmissionError:{description:!1,amount:!1,date:!1,source:!1,destination:!1},transaction:{description:"",date:s,time:e,amount:0,source:"",destination:"",budget:"",category:"",subscription:"",interest_date:"",book_date:"",process_date:"",due_date:"",payment_date:"",invoice_date:""}}}},preFetch(){}};var Q=t(1639),M=t(9885),D=t(7128),R=t(8879),F=t(9800),H=t(4106),P=t(4458),B=t(3190),j=t(6611),z=t(1221),K=t(9984),O=t.n(K);const G=(0,Q.Z)($,[["render",q]]),Y=G;O()($,"components",{QPage:M.Z,QBanner:D.Z,QBtn:R.Z,QTabPanels:F.Z,QTabPanel:H.Z,QCard:P.Z,QCardSection:B.Z,QInput:j.Z,QCheckbox:z.Z})}}]);